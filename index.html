<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Planner</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KDJWFCD30G"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-KDJWFCD30G');
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #374151;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }

        .planner-list {
            list-style: none;
            padding: 0;
            width: 100%;
        }

        .planner-item {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding: 1.25rem 1.5rem;
            margin-bottom: 0.75rem;
            background-color: #ffffff;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
        }

        .planner-item.completed {
            background-color: #d1fae5;
            color: #10b981;
            box-shadow: 0 4px 6px rgba(16, 185, 129, 0.2);
        }

        .planner-item.completed .item-text {
            text-decoration: line-through;
            font-style: italic;
        }

        .item-text {
            flex-grow: 1;
            font-size: 1.25rem;
            font-weight: 600;
            margin-left: 1.25rem;
        }

        .check-box {
            cursor: pointer;
            width: 1.75rem;
            height: 1.75rem;
            border-radius: 8px;
            border: 2px solid #6b7280;
            accent-color: #2563eb;
        }

        .custom-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
            min-width: 300px;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }

        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            color: #6b7280;
            transition: color 0.2s ease;
        }

        .icon-btn:hover {
            color: #1f2937;
        }

        /* Footer pop-up styles */
        .footer-popup {
            position: fixed;
            bottom: 6rem;
            right: 2rem;
            background-color: white;
            padding: 1.5rem;
            border-radius: 16px;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
            z-index: 10;
            display: none;
        }

        /* Info icon position */
        #info-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 11;
            /* Ensure it's above the footer pop-up */
        }
    </style>
</head>

<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen">

    <div class="modal-overlay" id="modal-overlay"></div>
    <div class="custom-modal" id="custom-modal">
        <p id="modal-message" class="text-center font-semibold mb-4"></p>
        <button id="modal-close-btn"
            class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg">OK</button>
    </div>

    <div class="w-full max-w-xl bg-white p-8 rounded-3xl shadow-xl">
        <div class="flex items-center justify-center mb-6">
            <img src="favicon.svg" alt="Daily Planner" class="w-12 h-12 mr-3">
            <h1 class="text-4xl font-extrabold text-center text-gray-800">Daily Planner</h1>
        </div>

        <!-- Date Navigation -->
        <div class="flex justify-between items-center mb-6 px-4">
            <button id="prev-day" class="p-2 rounded-full bg-gray-200 hover:bg-gray-300 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            <h2 id="current-date" class="text-2xl font-bold text-gray-700"></h2>
            <button id="next-day" class="p-2 rounded-full bg-gray-200 hover:bg-gray-300 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </button>
        </div>

        <!-- Add Task Section -->
        <div class="flex mb-6 px-4 gap-2">
            <input id="new-task-input" type="text" placeholder="Add a new task..."
                class="flex-grow p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition-colors">
            <button id="add-task-btn"
                class="p-3 bg-blue-500 hover:bg-blue-600 text-white font-bold rounded-lg transition-colors">Add</button>
        </div>

        <!-- Planner list -->
        <ul id="planner-list" class="planner-list">
            <!-- Tasks will be dynamically added here -->
        </ul>
    </div>

    <!-- Info Icon -->
    <button id="info-btn" class="icon-btn">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-gray-400 hover:text-gray-600 transition-colors"
            fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
    </button>

    <!-- Footer Pop-up -->
    <div id="footer-popup" class="footer-popup">
        <button id="close-footer-btn"
            class="absolute top-2 right-2 p-1 text-gray-400 hover:text-gray-600 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd"
                    d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                    clip-rule="evenodd" />
            </svg>
        </button>
        <footer class="text-center text-gray-500 text-xs">
            Â© 2025 - <span id="current-year"></span> Daily Planner. All rights reserved. 
            <!-- Made by <a href="https://kabeershah.com/" target="_blank" class="underline hover:text-blue-500">kabeershah.com</a> -->
        </footer>
    </div>

    <script>
        const plannerList = document.getElementById('planner-list');
        const currentDateEl = document.getElementById('current-date');
        const prevDayBtn = document.getElementById('prev-day');
        const nextDayBtn = document.getElementById('next-day');
        const newTaskInput = document.getElementById('new-task-input');
        const addTaskBtn = document.getElementById('add-task-btn');
        const customModal = document.getElementById('custom-modal');
        const modalOverlay = document.getElementById('modal-overlay');
        const modalMessage = document.getElementById('modal-message');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const infoBtn = document.getElementById('info-btn');
        const footerPopup = document.getElementById('footer-popup');
        const closeFooterBtn = document.getElementById('close-footer-btn');

        function showMessage(message) {
            modalMessage.textContent = message;
            customModal.style.display = 'block';
            modalOverlay.style.display = 'block';
        }

        modalCloseBtn.addEventListener('click', () => {
            customModal.style.display = 'none';
            modalOverlay.style.display = 'none';
        });

        // Local storage keys
        const LOCAL_STORAGE_TASK_KEY = 'daily-planner-tasks';
        const LOCAL_STORAGE_HISTORY_KEY = 'daily-planner-history';

        // Predefined tasks for the first time the app is loaded
        const defaultTasks = [];

        let currentDate = new Date();
        let tasks = [];

        function formatDate(date) {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        function saveState() {
            try {
                // Save the current list of tasks
                localStorage.setItem(LOCAL_STORAGE_TASK_KEY, JSON.stringify(tasks));

                // Save the completion history
                const historyJSON = localStorage.getItem(LOCAL_STORAGE_HISTORY_KEY);
                const history = historyJSON ? JSON.parse(historyJSON) : {};
                const dateKey = currentDate.toISOString().slice(0, 10);
                const currentState = {};
                const items = plannerList.querySelectorAll('.planner-item');
                items.forEach(item => {
                    const taskId = item.dataset.taskId;
                    const checkbox = item.querySelector('.check-box');
                    currentState[taskId] = checkbox.checked;
                });
                history[dateKey] = currentState;
                localStorage.setItem(LOCAL_STORAGE_HISTORY_KEY, JSON.stringify(history));
            } catch (e) {
                console.error("Error saving to localStorage:", e);
                showMessage("Your browser is blocking local storage. Progress will not be saved.");
            }
        }

        function loadState() {
            try {
                // Load tasks
                const storedTasks = localStorage.getItem(LOCAL_STORAGE_TASK_KEY);
                tasks = storedTasks ? JSON.parse(storedTasks) : defaultTasks;

                // Load history for the current date
                const historyJSON = localStorage.getItem(LOCAL_STORAGE_HISTORY_KEY);
                const history = historyJSON ? JSON.parse(historyJSON) : {};
                const dateKey = currentDate.toISOString().slice(0, 10);
                const currentState = history[dateKey] || {};

                // Clear the current list and re-render
                plannerList.innerHTML = '';
                tasks.forEach(task => {
                    const listItem = document.createElement('li');
                    listItem.className = 'planner-item';
                    listItem.dataset.taskId = task.id;

                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'check-box';
                    checkbox.checked = currentState[task.id] || false;

                    const textSpan = document.createElement('span');
                    textSpan.className = 'item-text';
                    textSpan.textContent = task.text;

                    // Edit Button
                    const editBtn = document.createElement('button');
                    editBtn.className = 'icon-btn edit-btn';
                    editBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232L18.766 8.766M16.924 3.076a2.5 2.5 0 113.536 3.536L14.732 18.732H11.2V15.207l9.17-9.17z"/></svg>`;

                    // Delete Button
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'icon-btn delete-btn';
                    deleteBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1H9a1 1 0 00-1 1v3M4 7h16" /></svg>`;

                    listItem.appendChild(checkbox);
                    listItem.appendChild(textSpan);
                    listItem.appendChild(editBtn);
                    listItem.appendChild(deleteBtn);

                    plannerList.appendChild(listItem);
                });

                // Update UI based on loaded state
                const items = plannerList.querySelectorAll('.planner-item');
                items.forEach(item => {
                    const checkbox = item.querySelector('.check-box');
                    if (checkbox.checked) {
                        item.classList.add('completed');
                    } else {
                        item.classList.remove('completed');
                    }
                });

                // Update the date display
                currentDateEl.textContent = formatDate(currentDate);

            } catch (e) {
                console.error("Error loading from localStorage:", e);
                showMessage("Could not load saved data. Your browser may be blocking local storage.");
            }
        }

        function addTask() {
            const taskText = newTaskInput.value.trim();
            if (taskText) {
                const newTaskId = `task_${Date.now()}`;
                tasks.push({ id: newTaskId, text: taskText });
                newTaskInput.value = '';
                saveState();
                loadState(); // Reload the list to display the new task
            }
        }

        // Event listener for checkboxes and buttons
        plannerList.addEventListener('click', (e) => {
            const item = e.target.closest('.planner-item');
            if (!item) return;
            const taskId = item.dataset.taskId;

            if (e.target.type === 'checkbox') {
                const isCompleted = e.target.checked;
                if (isCompleted) {
                    item.classList.add('completed');
                } else {
                    item.classList.remove('completed');
                }
                saveState();
            } else if (e.target.closest('.delete-btn')) {
                // Find the index of the task to be deleted
                const taskIndex = tasks.findIndex(task => task.id === taskId);
                if (taskIndex > -1) {
                    tasks.splice(taskIndex, 1);
                    saveState();
                    loadState(); // Re-render the list
                }
            } else if (e.target.closest('.edit-btn')) {
                const textSpan = item.querySelector('.item-text');
                const checkbox = item.querySelector('.check-box');
                const editBtn = item.querySelector('.edit-btn');
                const deleteBtn = item.querySelector('.delete-btn');

                // Create an input field to replace the text span
                const editInput = document.createElement('input');
                editInput.type = 'text';
                editInput.value = textSpan.textContent;
                editInput.className = 'flex-grow p-2 rounded-lg border-2 border-blue-500 focus:outline-none transition-colors';

                // Hide existing elements and show the input
                textSpan.style.display = 'none';
                checkbox.style.display = 'none';
                editBtn.style.display = 'none';
                deleteBtn.style.display = 'none';

                item.insertBefore(editInput, textSpan);
                editInput.focus();

                const saveEdit = () => {
                    const newTaskText = editInput.value.trim();
                    if (newTaskText) {
                        // Find the task and update its text
                        const taskToUpdate = tasks.find(task => task.id === taskId);
                        if (taskToUpdate) {
                            taskToUpdate.text = newTaskText;
                            saveState();
                            loadState(); // Re-render the list with the updated task
                        }
                    } else {
                        // If text is empty, delete the task
                        const taskIndex = tasks.findIndex(task => task.id === taskId);
                        if (taskIndex > -1) {
                            tasks.splice(taskIndex, 1);
                            saveState();
                            loadState();
                        }
                    }
                };

                // Save on blur or enter key
                editInput.addEventListener('blur', saveEdit);
                editInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        saveEdit();
                    }
                });
            }
        });

        // Navigation buttons
        prevDayBtn.addEventListener('click', () => {
            currentDate.setDate(currentDate.getDate() - 1);
            loadState();
        });

        nextDayBtn.addEventListener('click', () => {
            currentDate.setDate(currentDate.getDate() + 1);
            loadState();
        });

        // Add task button
        addTaskBtn.addEventListener('click', addTask);
        newTaskInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                addTask();
            }
        });

        // Toggle footer pop-up
        infoBtn.addEventListener('click', () => {
            footerPopup.style.display = 'block';
        });

        closeFooterBtn.addEventListener('click', () => {
            footerPopup.style.display = 'none';
        });

        // Load the saved state when the page loads
        window.onload = function () {
            loadState();
            // Set the current year in the footer
            document.getElementById('current-year').textContent = new Date().getFullYear();
            
            // Health check API call
            fetch('https://user-authentication-service-idnv.onrender.com/health')
                .catch(error => console.log('Health check failed:', error));
        };
    </script>
</body>

</html>